<!DOCTYPE html>
<html>

<head>
    <title>SoundCloud Widget Test</title>
    <script src="https://w.soundcloud.com/player/api.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }

        .test-block {
            margin: 20px 0;
            padding: 15px;
            background: #16213e;
            border-radius: 8px;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }

        #log {
            background: #000;
            color: #0f0;
            padding: 15px;
            font-family: monospace;
            height: 300px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <h1>SoundCloud Widget API Test</h1>

    <div class="test-block">
        <!-- Versuch: API URL Format (Shimmer) -->
        <iframe id="sc-player" width="100%" height="166" scrolling="no" frameborder="no" allow="autoplay"
            src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/2250168776%3Fsecret_token%3Ds-3bZeXboRF2l&auto_play=false&hide_related=true&show_comments=false&buying=false&sharing=false&download=false&show_artwork=true&visual=false">
        </iframe>
        <br><br>
        <button onclick="testPlay()">Play</button>
        <button onclick="testPause()">Pause</button>
        <button onclick="testGetInfo()">Get Track Info</button>
    </div>

    <div class="test-block">
        <h2>Debug Log</h2>
        <div id="log"></div>
    </div>

    <script>
        const logEl = document.getElementById('log');
        function log(msg) {
            const time = new Date().toLocaleTimeString();
            logEl.innerHTML += `[${time}] ${msg}<br>`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(msg);
        }

        log('Initializing...');
        log('SC object exists: ' + (typeof SC !== 'undefined'));

        const iframe = document.getElementById('sc-player');
        let widget = null;

        iframe.onload = function () {
            log('Iframe loaded');

            if (typeof SC === 'undefined') {
                log('ERROR: SC not defined!');
                return;
            }

            widget = SC.Widget(iframe);
            log('Widget created: ' + (widget !== null));

            widget.bind(SC.Widget.Events.READY, function () {
                log('✓ READY event fired');

                widget.getDuration(function (duration) {
                    log('Duration: ' + (duration / 1000) + ' seconds');
                });

                widget.getCurrentSound(function (sound) {
                    log('Current Sound: ' + JSON.stringify(sound ? sound.title : 'null'));
                });
            });

            widget.bind(SC.Widget.Events.PLAY, function () {
                log('▶ PLAY event fired');
            });

            widget.bind(SC.Widget.Events.PAUSE, function () {
                log('⏸ PAUSE event fired');
            });

            widget.bind(SC.Widget.Events.FINISH, function () {
                log('⏹ FINISH event fired');
            });

            widget.bind(SC.Widget.Events.PLAY_PROGRESS, function (data) {
                // Only log every 5 seconds
                if (Math.floor(data.currentPosition / 1000) % 5 === 0) {
                    log('Progress: ' + Math.floor(data.currentPosition / 1000) + 's');
                }
            });

            widget.bind(SC.Widget.Events.ERROR, function (e) {
                log('ERROR: ' + JSON.stringify(e));
            });
        };

        function testPlay() {
            if (widget) {
                log('Calling widget.play()...');
                widget.play();
            } else {
                log('Widget not ready');
            }
        }

        function testPause() {
            if (widget) {
                log('Calling widget.pause()...');
                widget.pause();
            } else {
                log('Widget not ready');
            }
        }

        function testGetInfo() {
            if (widget) {
                widget.getCurrentSound(function (sound) {
                    log('Sound Info: ' + JSON.stringify(sound, null, 2));
                });
            }
        }
    </script>
</body>

</html>